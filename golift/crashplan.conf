# https://github.com/jlesage/docker-crashplan-pro#routing-based-on-url-path

# CrashPlan PRO
location  ~  ^/crashplan(?<requesturi>/.*) {
  auth_request       /auth-2;
  auth_request_set   $user $upstream_http_x_organizr_user;
  more_set_headers   "X-WEBAUTH-USER: $user";
	proxy_http_version 1.1;
	proxy_set_header   Upgrade $http_upgrade;
	proxy_set_header   Connection $connection_upgrade;
	proxy_read_timeout 86400;
  proxy_pass         $crashplan$requesturi;
}

# These are weird.
location  ~  ^/js/(novnc-core|novnc-ui).min.js.map {
  auth_request       /auth-2;
  auth_request_set   $user $upstream_http_x_organizr_user;
  more_set_headers   "X-WEBAUTH-USER: $user";
  proxy_pass         $crashplan/js/$1.min.js.map;
}
